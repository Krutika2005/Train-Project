<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LocoPilot Dashboard</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  margin: 0;
  background: #f4f6fa;
  color: #333;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #004aad;
  color: #fff;
  padding: 15px 30px;
  box-shadow: 0px 3px 6px rgba(0,0,0,0.2);
}

header h1 { font-size: 20px; margin: 0; }
#clock { font-weight: bold; font-size: 16px; }

.dashboard {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  padding: 30px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
  cursor: pointer;
}

.card:hover { transform: translateY(-5px); }
.card i { font-size: 50px; color: #004aad; margin-bottom: 10px; }
.card h2 { font-size: 18px; margin: 10px 0; }

.signal-box {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.light {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #333;
  margin: 10px 0;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.6);
}

.active.red { background: red; }
.active.yellow { background: yellow; }
.active.green { background: limegreen; }

.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center; align-items: center;
  z-index: 999;
}

.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  width: 450px;
  max-width: 90%;
  text-align: left;
}

.modal-content h3 { margin-top: 0; color: #004aad; }
.close { float: right; font-size: 22px; font-weight: bold; cursor: pointer; }

.problem-list li {
  background: #f4f6fa;
  padding: 10px;
  border-radius: 8px;
  margin: 6px 0;
  cursor: pointer;
}

.problem-list li:hover { background: #dce6f7; }

button {
  background: #004aad;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
}

button:hover { background: #00327a; }

input[type="text"] { 
  width: 95%; 
  padding: 10px; 
  margin-top: 10px; 
  border: 1px solid #ccc; 
  border-radius: 6px; 
}

#solutionPage { display: none; padding: 30px; text-align: center; }

#solutionBox {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
  max-width: 500px;
  margin: auto;
  white-space: pre-line;
}
</style>
</head>
<body>
<header>
  <h1>LocoPilot Dashboard</h1>
  <div id="clock"></div>
</header>

<div id="dashboard" class="dashboard">
  <div class="card" onclick="openModal('trainModal')">
    <i class="fas fa-train"></i>
    <h2>Train Info</h2>
  </div>
  <div class="card" onclick="openModal('problemModal')">
    <i class="fas fa-exclamation-triangle"></i>
    <h2>Report Problem</h2>
  </div>
  <div class="card" onclick="openModal('contactModal')">
    <i class="fas fa-headset"></i>
    <h2>Contact Station Master</h2>
  </div>
  <div class="card signal-box">
    <h2>Live Signal</h2>
    <div id="red" class="light red"></div>
    <div id="yellow" class="light"></div>
    <div id="green" class="light"></div>
  </div>
</div>

<!-- Train Modal -->
<div id="trainModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('trainModal')">&times;</span>
    <h3>Train Details</h3>
    <p><b>Train Number:</b> 12345</p>
    <p><b>Arrival Time:</b> 10:30 AM</p>
    <p><b>Departure Time:</b> 10:45 AM</p>
    <p><b>Station:</b> Pune Junction</p>
    <p><b>Platform:</b> 3</p>
  </div>
</div>

<!-- Problem Modal -->
<div id="problemModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('problemModal')">&times;</span>
    <h3>Select Problem</h3>
    <ul class="problem-list">
      <li onclick="showRelatedProblems('Signal Failure')">Signal Failure</li>
      <li onclick="showRelatedProblems('Track Obstruction')">Track Obstruction</li>
      <li onclick="showRelatedProblems('Technical Fault')">Technical Fault</li>
      <li onclick="showRelatedProblems('Passenger Issue')">Passenger Issue</li>
    </ul>

    <!-- ✅ Voice-enabled input -->
    <div style="display:flex;align-items:center;gap:10px;">
      <input type="text" id="customProblem" placeholder="Or speak/type new problem here..." />
      <button onclick="startVoice()" title="Speak Problem">🎤</button>
    </div>

    <div id="relatedBox"></div>
    <button onclick="submitProblem()">Submit</button>
  </div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('contactModal')">&times;</span>
    <h3>Contact Station Master</h3>
    <p><b>Name:</b> Rajesh Sharma</p>
    <p><b>Phone:</b> +91 9876543210</p>
    <button>Call Now</button>
  </div>
</div>

<!-- Solution Page -->
<div id="solutionPage">
  <div id="solutionBox">
    <h2>AI/ML Suggested Solution</h2>
    <p id="solutionText"></p>
    <button onclick="markResolved()">Mark as Resolved</button>
  </div>
</div>

<script>
let selectedProblem = "";

function updateClock() {
  let now = new Date();
  document.getElementById("clock").innerText = now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
window.onload = updateClock;

function openModal(id){ document.getElementById(id).style.display="flex"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }

const relatedProblems = {
  "Signal Failure": ["Red signal not functioning","Yellow signal stuck","Green signal not visible","Signal flickering","Backup signal inactive","Power issue in signal","Signal maintenance overdue"],
  "Track Obstruction": ["Fallen tree on track","Vehicle on track","Landslide/debris","Loose rails","Animals on track","Track damage","Construction material on track"],
  "Technical Fault": ["Engine failure","Brake malfunction","AC/Lighting failure","Door malfunction","Coupling issue","Smoke or fire in coach","Control system fault"],
  "Passenger Issue": ["Medical emergency","Passenger fight/argument","Passenger blocking aisle","Unattended baggage","Overcrowding","Passenger distress","Safety/security concern"]
};

// Show related issues as checkboxes
function showRelatedProblems(problem){
  selectedProblem = problem;
  const box = document.getElementById("relatedBox");
  box.innerHTML = "<p><b>Related Issues:</b></p>";

  relatedProblems[problem].forEach(item=>{
    let div = document.createElement("div");
    div.style.margin="5px 0";

    let checkbox = document.createElement("input");
    checkbox.type="checkbox";
    checkbox.value=item;
    checkbox.id=item;

    let label = document.createElement("label");
    label.htmlFor=item;
    label.innerText=item;
    label.style.marginLeft="6px";

    div.appendChild(checkbox);
    div.appendChild(label);
    box.appendChild(div);
  });
}

// Submit problem
function submitProblem(){
  let custom=document.getElementById("customProblem").value.trim();
  let selectedItems=[];
  const checkboxes=document.querySelectorAll("#relatedBox input[type='checkbox']");
  checkboxes.forEach(cb=>{ if(cb.checked) selectedItems.push(cb.value); });

  if(custom!==""){ selectedProblem=custom; selectedItems=[]; }

  if(!selectedProblem && selectedItems.length===0){
    alert("⚠️ Please select or type a problem before submitting."); return;
  }

  closeModal("problemModal");
  document.getElementById("dashboard").style.display="none";
  document.getElementById("solutionPage").style.display="block";

  let solutionText="Problem Reported: "+selectedProblem;
  if(selectedItems.length>0) solutionText+="\nRelated Issues: "+selectedItems.join(", ");
  solutionText+="\n\nAI/ML Suggestion: Train will be rerouted to Platform 4 to avoid delay.";
  document.getElementById("solutionText").innerText=solutionText;
}

// Mark resolved
function markResolved(){ alert("✅ Problem marked as resolved. Notification sent."); location.reload(); }

// Cycle live signal
let signalColors=["red","yellow","green"], index=0;
setInterval(()=>{
  document.getElementById("red").classList.remove("active","red");
  document.getElementById("yellow").classList.remove("active","yellow");
  document.getElementById("green").classList.remove("active","green");
  document.getElementById(signalColors[index]).classList.add("active",signalColors[index]);
  index=(index+1)%signalColors.length;
},3000);

// ✅ Voice Recognition
let recognition;
if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = "en-IN";  
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onresult = function(event) {
    let transcript = event.results[0][0].transcript;
    document.getElementById("customProblem").value = transcript;
  };

  recognition.onerror = function(event) {
    alert("Voice input error: " + event.error);
  };
}

function startVoice() {
  if (recognition) {
    recognition.start();
  } else {
    alert("Voice recognition not supported in this browser.");
  }
}
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
